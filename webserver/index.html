<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/index.css">
    <script src="/js/jquery.min.js"></script>
    <title>后台管理系统</title>
</head>
<body>
    <div class="cloud">
        <div class="zoom">
            <h2>用户信息</h2>
            <!-- <form action="http://localhost:3000/api/updateUserInfo" method="post" enctype="multipart/form-data"> -->
                <input type="text" id="cloud_username" name="username" value="张三" />
                <input type="file" id="avator" name="abc" placeholder="请选择头像" />
                <img id="avator_img" src="./images/avator.png">
        
                <button id="ok">修改</button>
                <!-- <input type="submit" /> -->
                <button id="cancel">取消</button>
            <!-- </form> -->
        </div>
        <div class="mask"></div>
    </div>
    <div id="warp">
        <div class="leftMeun">
            <div class="logo">
                <h1>加菲猫的管理系统</h1>
            </div>
            <div id="personInfor">
                <p><a class="user"><img class="avator" src="images/avator.png" style="width: 50px;height: 50px;"/></a></p>
                <p id="userName">加菲</p>
                <p><span>983446103@qq.com</span></p>
                <p>
                    <a>退出登录</a>
                </p>
            </div>
            <div class="meun-title">账号管理</div>
            <div id="zy" class="meun-item meun-item-active" href="#sour" aria-controls="sour" role="tab" data-toggle="tab"><img src="images/icon_source.png">资源管理</div>
            <div id="qx" class="meun-item" href="#char"><img src="images/icon_chara_grey.png">权限管理</div>
            <div class="meun-item" href="#user"><img src="images/icon_user_grey.png">用户管理</div>
            <div class="meun-item" href="#chan"><img src="images/icon_change_grey.png">修改密码</div>
        </div>
        <div class="rightContent">
            
            <div class="table-content">
            <!-- 资源管理模块 S-->
                <div role="tabpanel" class="tab-pane active" id="sour">
                        <div class="check-div form-inline">
                            <button class="btn btn-yellow btn-xs" data-toggle="modal" data-target="#addSource">添加资源</button>
                        </div>
                        <div class="data-div">
                            <div class="row tableHeader">
                                <div class="col-lg-1 col-md-1 col-sm-1 col-xs-1 ">
                                    编码
                                </div>
                                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
                                    名称
                                </div>
                                <div class="col-lg-5 col-md-5 col-sm-5 col-xs-5">
                                    链接
                                </div>
                                <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2">
                                    操作
                                </div>
                            </div>
                            <div class="tablebody">
                                    <div class="row">
                                            <div class="col-lg-1 col-md-1 col-sm-1 col-xs-1">
                                                1
                                            </div>
                                            <div id="topAD" class="col-lg-4 col-md-4 col-sm-4 col-xs-4" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseSystem" aria-expanded="true" aria-controls="collapseOne">
                                                <span id="topA" class="glyphicon  glyphicon-triangle-bottom  "></span><span>系统管理</span>
                                            </div>
                                            <div class="col-lg-5 col-md-5 col-sm-5 col-xs-5">
                                                /admin/system/userlist/software/
                                            </div>
                                            <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2">
                                                <button class="btn btn-success btn-xs" data-toggle="modal" data-target="#changeSource">修改</button>
                                                <button class="btn btn-danger btn-xs" data-toggle="modal" data-target="#deleteSource">删除</button>
                                            </div>
                                    </div>
                                    <!--系统管理折叠狂-->
                                    <div id="collapseSystem" class="collapse in" aria-expanded="true">
                                        <div class="row">
                                            <div class="col-lg-1 col-md-1 col-sm-1 col-xs-1 levl2 ">
                                                2
                                            </div>
                                            <div id="topBD" class="col-lg-4 col-md-4 col-sm-4 col-xs-4 levl2" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseAccount" aria-expanded="true" aria-controls="collapseOne">
                                                <span onClick="changeB()" id="topB" class="glyphicon glyphicon-triangle-bottom"></span><span>账号管理</span>
                                            </div>
                                            <div class="col-lg-5 col-md-5 col-sm-5 col-xs-5">
                                                /rlist/
                                            </div>
                                            <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2">
                                                <button class="btn btn-success btn-xs" data-toggle="modal" data-target="#changeSource">修改</button>
                                                <button class="btn btn-danger btn-xs" data-toggle="modal" data-target="#deleteSource">删除</button>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-lg-1 col-md-1 col-sm-1 col-xs-1  levl3 ">
                                                2
                                            </div>
                                            <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4  levl3">
                                                <span></span><span>权限管理</span>
                                            </div>
                                            <div class="col-lg-5 col-md-5 col-sm-5 col-xs-5">
                                                /admin/system/userlist/software/
                                            </div>
                                            <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2">
                                                <button class="btn btn-success btn-xs" data-toggle="modal" data-target="#changeSource">修改</button>
                                                <button class="btn btn-danger btn-xs" data-toggle="modal" data-target="#deleteSource">删除</button>
                                            </div>
                                        </div>
                                    </div>
                        </div>
                </div>
                 <!--页码块-->
                 <footer class="footer">
                        <ul class="pagination">
                            <li>
                                <select>
                                    <option>1</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                    <option>5</option>
                                    <option>6</option>
                                    <option>7</option>
                                    <option>8</option>
                                    <option>9</option>
                                    <option>10</option>
                                </select>
                                页
                            </li>
                            <li class="gray">
                                共20页
                            </li>
                            <li>
                                <i class="glyphicon glyphicon-menu-left">
                                </i>
                            </li>
                            <li>
                                <i class="glyphicon glyphicon-menu-right">
                                </i>
                            </li>
                        </ul>
                </footer>
                </div>
               
            <!-- 资源管理模块 E-->
            <!-- 权限管理模块 S-->
            <div role="tabpanel" class="tab-pane" style="display: none" id="char">

                    <div class="check-div">
                        <button class="btn btn-yellow btn-xs" data-toggle="modal" data-target="#addChar">添加权限</button>
                    </div>
                    <div class="data-div">
                        <div class="row tableHeader">
                            <div class="col-xs-1 ">
                                编码
                            </div>
                            <div class="col-xs-4">
                                权限名
                            </div>
                            <div class="col-xs-5">
                                描述
                            </div>
                            <div class="col-xs-2">
                                操作
                            </div>
                        </div>
                        <div class="tablebody">
                            <div class="row">
                                <div class="col-xs-1 ">
                                    1
                                </div>
                                <div class="col-xs-4">
                                </span><span>管理员</span>
                        </div>
                        <div class="col-xs-5">
                            管理员具有超年权限
                        </div>
                        <div class="col-xs-2">
                            <button class="btn btn-success btn-xs" data-toggle="modal" data-target="#changeChar">修改</button>
                            <button class="btn btn-danger btn-xs" data-toggle="modal" data-target="#deleteChar">删除</button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-1 ">
                            2
                        </div>
                        <div class="col-xs-4">
                            <span>游客</span>
                        </div>
                        <div class="col-xs-5">
                            可以查看信息
                        </div>
                        <div class="col-xs-2">
                            <button class="btn btn-success btn-xs">修改</button>
                            <button class="btn btn-danger btn-xs">删除</button>
                        </div>
                    </div>

                </div>

            </div>
            <!--页码块-->
            <footer class="footer">
                <ul class="pagination">
                    <li>
                        <select>
                            <option>1</option>
                            <option>2</option>
                            <option>3</option>
                            <option>4</option>
                            <option>5</option>
                            <option>6</option>
                            <option>7</option>
                            <option>8</option>
                            <option>9</option>
                            <option>10</option>
                        </select>
                        页
                    </li>
                    <li class="gray">
                        共20页
                    </li>
                    <li>
                        <i class="glyphicon glyphicon-menu-left">
                        </i>
                    </li>
                    <li>
                        <i class="glyphicon glyphicon-menu-right">
                        </i>
                    </li>
                </ul>
            </footer>
            </div>
            <!-- 权限管理模块 E--> 
       </div>
    </div>  
    <script src="js/jquery.min.js"></script>
    <script>
        $(function() {
            $("#topAD").click(function() {
                $("#topA").toggleClass(" glyphicon-triangle-right");
                $("#topA").toggleClass(" glyphicon-triangle-bottom");
            });
            $("#topBD").click(function() {
                $("#topB").toggleClass(" glyphicon-triangle-right");
                $("#topB").toggleClass(" glyphicon-triangle-bottom");
            });
            $("#topCD").click(function() {
                $("#topC").toggleClass(" glyphicon-triangle-right");
                $("#topC").toggleClass(" glyphicon-triangle-bottom");
            });
            $(".toggle-btn").click(function() {
                $("#leftMeun").toggleClass("show");
                $("#rightContent").toggleClass("pd0px");
            })
            $('.meun-item').click(function(){
                $(this).addClass('meun-item-active').siblings().removeClass('meun-item-active');
            })
            $("#qx").click(function(){
                
                $("#char").show()
                $("#sour").hide()
            })
            
            //请求当前用户的基本信息
            
            // 0. 先从localstorage中取出 token
            let token = localStorage.getItem('token');
            if(!token) {
                alert('用户未登录')
                location.href = '/login.html'
            }
            $.ajax({
                url : 'http://localhost:3000/api/getUserInfo',
                method : 'GET',
                headers : {
                    //自定义请求头
                    // X-Access-Token 的值从哪里来
                    'X-Access-Token' : token

                },
                success : function(res){
                   // console.log(res)
                   if (res.code === 0 ) {
                       // res.userInfo.avator 这个存储的是文件名
                       //http://localhost:3000/res.userInfo.avator
                       var imgSrc = 'http://localhost:3000/' + res.userInfo.avator
                       $(".avator").attr('src',imgSrc);
                       $("#userName").html(res.userInfo.username);
                       //console.log($("#userName").html())
                       //弹窗内容
                        $("#cloud_username").val(res.userInfo.username)
                        $("#avaror_img").attr('src',imgSrc)
                   } else {
                       alert(res.msg)
                   }
                }
            })
            
            //弹框处理
            $(".user").click(function(){
                $(".cloud").show();
            })
            $("#cancel").click(function(){
                $(".cloud").hide()
            })
            $(".mask").click(function(){
                $(".cloud").hide();
            })

            // 修改用户信息
            $("#ok").click(function(){
                //alert(1)
                let token = localStorage.getItem('token');
                var formData = new FormData();
                //主动添加要传给后台的参数
                formData.append('username',$('[name=username]').val())
                //在 Dom 对象上 input框 type 类型为 file 属性的 默认有一个 files属性 是一个对象 需要拿到他的第0给元素
                formData.append('abc',$('#avator').get(0).files[0])
                $.ajax({
                    url : 'http://localhost:3000/api/updateUserInfo',
                    method : 'post',
                    //有文件的data 不能如下这样写 需要使用 FormData
                    //data : {}
                    data : formData,
                    processData : false, //上传文件，需要将这个选项设置为false
                    contentType : false,//上传文件，需要将这个选项设置为false
                    headers : {
                        'X-Access-Token' : token
                    },
                    success : function(res) {
                        if(res.code === 0) {
                            alert('上传成功');
                            location.reload();
                        }
                        console.log(res);
                    }
                })
            })



        })
    </script>  
</body>
</html>